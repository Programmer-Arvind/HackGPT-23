import re
import openai

# Using api key saved in the text file
openai.api_key_path = "./hackGPT_api_key.txt"

def gpt_get(destination):
    # Getting output from gpt-3.5-turbo model
    message = [{"role" : "user", "content" : f"I want to travel to {destination}.\
        Give me python lists for 6 common phrases (list name common_phrases) used there in day to day life\
        with meanings in another list named common_phrases_english, \
        the tourist places in list name tourist_places and their description in list named place_desc, \
        list named food with the popular food items there and their descriptions\
        in a list named food_desc. Enclose all list items by single quote!\
        DO NOT DO ANY OTHER PYTHON THINGS ONLY SEND THE LISTS AND DONT ADD ANY SPECIAL \
        CHARACTERS OR CHARACTERS IN ANY OTHER LANGUAGE. PUT VALID PYTHON LISTS PLEASE. LISTS IN ONE LINE"} ]
    completion = openai.ChatCompletion.create(
        model = "gpt-3.5-turbo",
        messages = message
    )
    
    reply =  completion.choices[0].message.content
    print(reply) # Printing reply just to know what is received
    
    # Using re module to use the python list generated by gpt api
    common_phrases_as_str = re.findall("common_phrases = \[(.+)\]", reply)[0]
    common_phrases_eng_as_str = re.findall("common_phrases_english = \[(.+)\]", reply)[0]
    tourist_places_as_str = re.findall("tourist_places = \[(.+)\]", reply)[0]
    place_descs_as_str = re.findall("place_desc = \[(.+)\]", reply)[0]
    foods_as_str = re.findall("food = \[(.+)\]", reply)[0]
    food_descs_as_str = re.findall("food_desc = \[(.+)\]", reply)[0]
    
    # Foods as str is like 'Vada pav', 'Pav Bhaji' so, split at ", " and strip the "'"
    # Same for all other things.
    common_phrases = [i.strip("'") for i in common_phrases_as_str.split(", ")]
    common_phrases_eng = [i.strip("'") for i in common_phrases_eng_as_str.split(", ")]
    tourist_places = [i.strip("'") for i in tourist_places_as_str.split(", ")]
    place_descs = [i.strip("'") for i in place_descs_as_str.split(", ")]
    foods = [i.strip("'") for i in foods_as_str.split(", ")]
    food_descs = [i.strip("'") for i in food_descs_as_str.split(", ")]
    return common_phrases, common_phrases_eng, tourist_places, place_descs,foods, food_descs
